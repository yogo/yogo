<div id="search-data">
  <%- form_for(@model, :url => search_project_yogo_data_path(@project, @model.name.demodulize), :html => {:method => :get} ) do |f| -%>
    <%= text_field_tag("search_term") %>
    <%= f.submit('Search within this set') %>
  <%- end -%>
</div>

<div id="data-index">

  <H3><%= @model.name.demodulize.titleize %> (<%= @model.count %>)</H3>

  <!-- This is an alternative to the table using google visualiztion api (the javascript is now included in the app) -->
  <%# cols = @model.usable_properties.map { |prop| [ Yogo::Types.dm_to_gv(prop.type), Extlib::Inflection.humanize(prop.name.to_s) ] }%>
  <%# gvdata = @data.map { |item| @model.usable_properties.map { |p| item[p.name]  } } %>
  <%# visualization("test_table", "Table", {:data => gvdata, :columns => cols }) { } %>

  <table id="data-index-table">
    <thead>
      <tr>
        <th class="data-index-table-actions"></th>
        <%- @model.usable_properties.each do |h| %>
        <th><%= h.name.to_s.titleize %></th>
        <%- end %>
      </tr>
    </thead>
    <tbody>
    <%- @data.each do |d| %>
      <tr class="<%=cycle("alternate-rows0","") %>">
        <td class="data-index-table-actions"><%= link_to(image_tag('view.gif', :alt => "View Item", :title => "View Item"), project_yogo_data_path(@project, @model.name.demodulize, d.yogo_id)) %>
        <%= link_to(image_tag('edit.png',:alt => "Edit Item", :title => "Edit Item"), edit_project_yogo_data_path(@project, @model.name.demodulize, d.yogo_id)) %>
        <%= link_to(image_tag('remove.png',:alt => "Delete Item", :title => "Delete Item"), project_yogo_data_path(@project, @model.name.demodulize, d.yogo_id), :method => :delete, :confirm => "There is no undo.\n Continue?") %></td>
        <%- @model.usable_properties.each do |p| %>
        <td><%= d[p.name] %></td>
        <%- end %>
      </tr>
      <%- end %>
    </tbody>
  </table>

  <div id="add-data-link">
    <%= link_to(image_tag('add.gif')+' Add Data', new_project_yogo_data_path(@project, @model.name.demodulize))%>
  </div>
</div>

<div id="pagination-links">
  <%= pagination_links(@query, params[:page], 10) %>
</div>

<%= render :partial => 'csv_form' %>


