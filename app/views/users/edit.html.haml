#content-sidebar-right
  - if Project.count > @user.projects.count
    - form_for(:membership, :url => user_memberships_path(@user)) do |f|
      - field_set_tag("Add Projects") do
        = select_tag("project_id", options_from_collection_for_select(Project.all.select { |p| not @user.projects.include?(p) }, 'id', 'name'))
        - for role in Role.all do
          .field-item
            = check_box_tag("memberships[roles][]", role.id, false, :class => "memberships_#{role.id}", :id => "memberships_#{role.id}")
            = label_tag("memberships_#{role.id}", role.name)
        = f.submit('Update', :class => 'icon icon-save')

#main-with-sidebar
  #content-actions
    = link_to("Delete", project_path(@project), :method => :delete, :class => 'icon icon-delete', 
              :confirm => "Do you want to delete the #{@user.name}?\nContinue?" )
  #content-title
    = @user.name
    #subtitle User Settings
  %br{:style=>"clear:left;"}/
  -form_for(@user, :builder => YogoFormBuilder) do |f|
    = f.text_field(:login, :label => "Login:" )
    = f.text_field(:first_name, :label => "First Name:")
    = f.text_field(:last_name, :label => "Last Name:")
    = f.text_field(:email, :label => "Email:")

    - if @user.new?
      = f.password_field(:password, :label => "Password: ")
      = f.password_field(:password_confirmation, :label => "Password Confirmation: ")
    = f.select(:system_role_id, SystemRole.all.map{|sr| [sr.name, sr.id]}, :label => 'System Role:')
    %strong API Key:
    = @user.api_key
    = link_to("Generate new API key", api_key_update_user_path(@user), :method => :put, :class => 'icon icon-save')
    %br/
    %strong Projects
    %table
      %thead
        %th Project
        %th Roles
        %th
      %tbody
        - unless @user.roles.empty? 
          - @user.roles.projects.each do |project|
            %tr
              %td= link_to(project.name, project_path(project))
              %td= @user.roles.select{|role| role.projects.include?(project) }.map{|role| role.name }.join(', ')     
              %td 
                #operation-links
                  #edit-link
                    = link_to("Edit", edit_user_membership_path(@user, project), :class => 'edit-link')
                  #delete-link
                    = link_to("Delete", user_membership_path(@user, project), :method => :delete, :class => 'icon icon-delete', :confirm => "Do you want to remove #{@user.first_name} #{@user.last_name} from the #{project.name} project?")
    = f.submit('Save', :class => 'icon icon-save')
    = link_to('Cancel', users_path, :class => 'icon icon-cancel')
= clear_break
